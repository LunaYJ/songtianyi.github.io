<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<header style="padding-bottom:50px">
<ul>
	<li style="float:left;padding-right:20px"><a href="../../index.html">Home</a></li>
</ul>
</header>

<style type="text/css">
	div{
		font-size:11pt;
	}
	p{
		text-indent:2em;/*段落缩进*/
		line-height:140%;/*行间距*/
	}
	blockquote {
		background:#f9f9f9;
		border-left:10px solid darkblue;
	}
	blockquote p {
		display:inline;
	}
</style>

<!--code examples

<a href=""></a>

<li><a style="text-decoration:none" href="#"></a></li>

<h2 id=""></h2>

<div style="text-align:center">
	<img  src="">
	<p>图 </p>
	</div>
		
	<sup>sup>

	<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;">
	</div>

	-->


	<div>

		<!--博文标题和作者信息-->
		<h2 style="text-align:center">Design the city-LCA/SparseTable</h2>
		<h5 style="text-align:right">update@2011-08-22</h5>
		     <div style="background:#fdfdfd;color:black;"><br></div>     <div style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);"> <span style="color: rgb(0, 128, 0); font-weight: bold;">struct</span> <span style="color: rgb(0, 0, 0);">tree_node</span>&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">{</span><span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">d</span><span style="color: rgb(0, 0, 0);">;};</span><br> <span style="color: rgb(0, 0, 0);">vector</span><span style="color: rgb(48, 48, 48);">&lt;</span><span style="color: rgb(0, 0, 0);">tree_node</span><span style="color: rgb(48, 48, 48);">&gt;</span>&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">];</span><br> <span style="color: rgb(0, 128, 0); font-weight: bold;">struct</span> <span style="color: rgb(0, 0, 0);">query_node</span>&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">{</span><span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">i_one</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">i_two</span><span style="color: rgb(0, 0, 0);">;};</span><br> <span style="color: rgb(0, 0, 0);">vector</span><span style="color: rgb(48, 48, 48);">&lt;</span><span style="color: rgb(0, 0, 0);">query_node</span><span style="color: rgb(48, 48, 48);">&gt;</span>&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">];</span><br> <br> <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">],</span><span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">],</span><span style="color: rgb(0, 0, 0);">visited</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">],</span><span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">50000</span><span style="color: rgb(0, 0, 0);">],</span><span style="color: rgb(0, 0, 0);">ans</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 208); font-weight: bold;">70000</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 208); font-weight: bold;">3</span><span style="color: rgb(0, 0, 0);">];</span><br> <br> <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">FindSet</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">x</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 0);">x</span> <span style="color: rgb(48, 48, 48);">==</span> <span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">x</span><span style="color: rgb(0, 0, 0);">]</span><span style="color: rgb(48, 48, 48);">?</span><span style="color: rgb(144, 112, 0); font-weight: bold;">x:</span>(<span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">x</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">FindSet</span>(<span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">x</span><span style="color: rgb(0, 0, 0);">]));</span><br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">void</span> <span style="color: rgb(0, 0, 0);">UnionSet</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">x</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">y</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">FindSet</span>(<span style="color: rgb(0, 0, 0);">y</span><span style="color: rgb(0, 0, 0);">)]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">FindSet</span>(<span style="color: rgb(0, 0, 0);">x</span>);<br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">void</span> <span style="color: rgb(0, 0, 0);">Tarjan_LCA</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">size_tree</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">size</span>();<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> <span style="color: rgb(0, 0, 0);">size_tree</span>;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><span style="color: rgb(128, 128, 128);">//遍历该节点的每个子节点</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">Tarjan_LCA</span>(<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span>);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">UnionSet</span>(<span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">visited</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">true</span>;<span style="color: rgb(128, 128, 128);">//访问是有序的但a b是无序的所以要进行标记</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">size_query_set</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">size</span>();<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> <span style="color: rgb(0, 0, 0);">size_query_set</span>;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">visited</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">]){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">ans</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">i_one</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">i_two</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span>\<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">+</span> <span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">-</span>\<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 208); font-weight: bold;">2</span><span style="color: rgb(48, 48, 48);">*</span><span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">FindSet</span>(<span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">)];</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//u到v的距离等于u到根的距离加上v到根的距离减去2倍LCA(u,v)到根的距离</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">void</span> <span style="color: rgb(0, 0, 0);">init</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> n<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> n;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">clear</span>();<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">clear</span>();<span style="color: rgb(128, 128, 128);">//query_set[i][j] (i &lt; n)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">father</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">i</span>;<span style="color: rgb(0, 0, 0);">visited</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">false</span>;<span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">true</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">findRoot</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> n<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> n;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">==</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">1</span>)<span style="color: rgb(0, 128, 0); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 0);">i</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">return</span> <span style="color: rgb(48, 48, 48);">-</span><span style="color: rgb(0, 0, 208); font-weight: bold;">1</span>;<br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">void</span> <span style="color: rgb(0, 0, 0);">dist_DFS</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">di</span>)<br> <span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//深搜计算每个点到根的距离</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">size_tree</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">size</span>();<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> <span style="color: rgb(0, 0, 0);">size_tree</span>;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">di</span> <span style="color: rgb(48, 48, 48);">+</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">d</span>;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">dist_DFS</span>(<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">u</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">]);</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//tree[u][i].d 为 u到tree[u][i].v的距离</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(0, 0, 0);">}</span><br> <br> <span style="color: rgb(128, 128, 128);">//main函数中的主要部分</span><br> <span style="color: rgb(0, 0, 0);">init</span>(n);<br> <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">1</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> n;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">scanf</span>(<span style="background-color: rgb(255, 240, 240);">"%d%d%d"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span>b<span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span><span style="color: rgb(0, 0, 0);">d</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree_node</span> <span style="color: rgb(0, 0, 0);">temp</span>;<span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">d</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">d</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span>b<span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">==</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">false</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//每个节点可以多次作为父节点但只能作一次子节点</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//即入度为1(根节点入度为0 也是根据这个来确定根节点的)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//这个就是构造树的过程</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">false</span>;<span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">a</span>;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span>b<span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 128, 0); font-weight: bold;">else</span><span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">is_root</span><span style="color: rgb(0, 0, 0);">[</span>b<span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">false</span>;<span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> b;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">Q</span>;<span style="color: rgb(0, 0, 0);">scanf</span>(<span style="background-color: rgb(255, 240, 240);">"%d"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span><span style="color: rgb(0, 0, 0);">Q</span>);<br> <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> <span style="color: rgb(0, 0, 0);">Q</span>;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">scanf</span>(<span style="background-color: rgb(255, 240, 240);">"%d%d%d"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span>b<span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(48, 48, 48);">&amp;</span><span style="color: rgb(0, 0, 0);">c</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_node</span> <span style="color: rgb(0, 0, 0);">temp</span>;<span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">i_one</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">i</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> b; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">i_two</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//a b</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">a</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span>b<span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//a b</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">c</span>; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">i_two</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">1</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//a c</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">a</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">c</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//a c</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">c</span>; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">i_two</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">2</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span>b<span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//b c</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">temp</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(0, 0, 0);">v</span> <span style="color: rgb(48, 48, 48);">=</span> b;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">query_set</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">c</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">push_back</span>(<span style="color: rgb(0, 0, 0);">temp</span>);<span style="color: rgb(128, 128, 128);">//b c</span><br> <br> <span style="color: rgb(0, 0, 0);">}</span><br> <span style="color: rgb(0, 0, 0);">root</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 0);">findRoot</span>(n); <span style="color: rgb(0, 0, 0);">dist</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">root</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>; <span style="color: rgb(0, 0, 0);">dist_DFS</span>(<span style="color: rgb(0, 0, 0);">root</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>);<br> <span style="color: rgb(0, 0, 0);">Tarjan_LCA</span>(<span style="color: rgb(0, 0, 0);">root</span>);<span style="color: rgb(0, 128, 0); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">test</span><span style="color: rgb(48, 48, 48);">++</span>)&nbsp; <span style="color: rgb(0, 0, 0);">printf</span>(<span style="background-color: rgb(255, 240, 240);">"</span><span style="color: rgb(96, 96, 96); font-weight: bold; background-color: rgb(255, 240, 240);">\n</span><span style="background-color: rgb(255, 240, 240);">"</span>);<br> <span style="color: rgb(0, 128, 0); font-weight: bold;">for</span>(<span style="color: rgb(48, 48, 144); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">=</span> <span style="color: rgb(0, 0, 208); font-weight: bold;">0</span>;<span style="color: rgb(0, 0, 0);">i</span> <span style="color: rgb(48, 48, 48);">&lt;</span> <span style="color: rgb(0, 0, 0);">Q</span>;<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(48, 48, 48);">++</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(128, 128, 128);">//减去重复的路径就是题目要求的结果</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">printf</span>(<span style="background-color: rgb(255, 240, 240);">"%d</span><span style="color: rgb(96, 96, 96); font-weight: bold; background-color: rgb(255, 240, 240);">\n</span><span style="background-color: rgb(255, 240, 240);">"</span><span style="color: rgb(0, 0, 0);">,(</span><span style="color: rgb(0, 0, 0);">ans</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 208); font-weight: bold;">0</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">+</span> <span style="color: rgb(0, 0, 0);">ans</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 208); font-weight: bold;">1</span><span style="color: rgb(0, 0, 0);">]</span> <span style="color: rgb(48, 48, 48);">+</span> <span style="color: rgb(0, 0, 0);">ans</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">][</span><span style="color: rgb(0, 0, 208); font-weight: bold;">2</span><span style="color: rgb(0, 0, 0);">])</span><span style="color: rgb(48, 48, 48);">/</span><span style="color: rgb(0, 0, 208); font-weight: bold;">2</span>);<br> <span style="color: rgb(0, 0, 0);">}</span><br></div><br><br><hr><br>题目链接：<a rel="nofollow" href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemId=3320">Design the city</a><br>这题不难，开始的时候没有想到是用LCA解（一直纳闷sample中的结果 我以为直接是距离加一下就行），然后想到的是floyd，floyd复杂度太高不可能行的，然后看了解题报告才知道要用LCA。先搞懂LCA 刷一个基础的LCA题，再来A这个就很简单了，不过感觉自己写的很二，可以看看<a rel="nofollow" href="http://www.fookwood.com/archives/278">fookwood的ST</a> （ST看过，忘的差不多了，好像要注意的是初始化的时的一个dp）。
		 </div>
