<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<header style="padding-bottom:50px">
<ul>
	<li style="float:left;padding-right:20px"><a href="../../index.html">Home</a></li>
</ul>
</header>

<style type="text/css">
	div{
		font-size:11pt;
	}
	p{
		text-indent:2em;/*段落缩进*/
		line-height:140%;/*行间距*/
	}
	blockquote {
		background:#f9f9f9;
		border-left:10px solid darkblue;
	}
	blockquote p {
		display:inline;
	}
</style>

<!--code examples

<a href=""></a>

<li><a style="text-decoration:none" href="#"></a></li>

<h2 id=""></h2>

<div style="text-align:center">
	<img  src="">
	<p>图 </p>
</div>
	
<sup>sup>

<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;">
</div>

-->


<div>

	<!--博文标题和作者信息-->
	<h2 style="text-align:center">A Simple Problem with Integers-线段树</h2>
	<h5 style="text-align:right">update@2011-08-01</h5>

	<div style="background:#fdfdfd;color:black;"><br></div>     <div style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: rgb(0, 0, 0); background-color: rgb(249, 247, 237);"> <span style="color: rgb(0, 0, 128); font-weight: bold;">struct</span> <span style="color: rgb(0, 0, 0);">node</span><span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">left</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">right</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">long</span> <span style="color: rgb(0, 0, 128); font-weight: bold;">long</span> <span style="color: rgb(0, 0, 0);">sum</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">weight</span>;<br> <span style="color: rgb(0, 0, 0);">}</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">upper_bound</span><span style="color: rgb(0, 0, 0);">];</span><br> <br> <span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">A</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">upper_bound</span><span style="color: rgb(0, 0, 0);">];</span><span style="color: rgb(0, 136, 0); font-style: italic;">//upper_bound_n</span><br> <br> <span style="color: rgb(0, 0, 128); font-weight: bold;">void</span> <span style="color: rgb(0, 0, 0);">build</span>(<span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> b<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 136, 0); font-style: italic;">//tree[i].left tree[i].right为节点i的左右边界</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">!=</span> b<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 0);">a</span>;<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span><span style="color: rgb(0, 0, 0);">=</span> b;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">build</span>(<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,(</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">+</span>b)<span style="color: rgb(0, 0, 0);">&gt;&gt;</span><span style="color: rgb(0, 0, 255);">1</span>);<span style="color: rgb(0, 136, 0); font-style: italic;">//递归构造左子树</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">build</span>((<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,((</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">+</span>b)<span style="color: rgb(0, 0, 0);">&gt;&gt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span>b);<span style="color: rgb(0, 136, 0); font-style: italic;">//递归构造右子树</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span>&nbsp; <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span> <span style="color: rgb(0, 0, 0);">+</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[(</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span>;<span style="color: rgb(0, 136, 0); font-style: italic;">//回溯 左右子树的和等于父节点</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">else</span><span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span> <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 0);">a</span>;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span>&nbsp; <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 0);">A</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">];</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span> <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 255);">0</span>;<br> <span style="color: rgb(0, 0, 0);">}</span><br> <br> <span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">add</span>(<span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> b<span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">==</span> <span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">&amp;&amp;</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span> <span style="color: rgb(0, 0, 0);">==</span> b<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 136, 0); font-style: italic;">//恰好是这个区间</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 136, 0); font-style: italic;">//如果遍历到叶子节点再加的话会超时的</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span> <span style="color: rgb(0, 0, 0);">+=</span> <span style="color: rgb(0, 0, 0);">v</span>;<span style="color: rgb(0, 136, 0); font-style: italic;">//将这个值保存而不是直接累加</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 255);">1</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">else</span><span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 136, 0); font-style: italic;">//不是该区间但是属于该区间</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span> <span style="color: rgb(0, 0, 0);">+=</span> <span style="color: rgb(0, 0, 0);">v</span><span style="color: rgb(0, 0, 0);">*</span>(b <span style="color: rgb(0, 0, 0);">-</span> <span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">+</span> <span style="color: rgb(0, 0, 255);">1</span>);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 136, 0); font-style: italic;">//之前写成 tree[i].sum += (tree[i].right - tree[i].left + 1)*v WA了好多次</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">mid</span> <span style="color: rgb(0, 0, 0);">=</span> (<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span>) <span style="color: rgb(0, 0, 0);">&gt;&gt;</span> <span style="color: rgb(0, 0, 255);">1</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">&lt;=</span> <span style="color: rgb(0, 0, 0);">mid</span> <span style="color: rgb(0, 0, 0);">&amp;&amp;</span> b <span style="color: rgb(0, 0, 0);">&gt;</span> <span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">add</span>(<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">v</span>);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">add</span>((<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span>b<span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">v</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">else</span><span style="color: rgb(0, 0, 0);">{</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">add</span>((<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span>(b<span style="color: rgb(0, 0, 0);">&lt;=</span><span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">?</span><span style="color: rgb(0, 0, 255);">0</span><span style="color: rgb(0, 0, 0);">:</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">),</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span>b<span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">v</span>);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 255);">1</span>;<br> <span style="color: rgb(0, 0, 0);">}</span><br> <br> <span style="color: rgb(0, 0, 128); font-weight: bold;">long</span> <span style="color: rgb(0, 0, 128); font-weight: bold;">long</span> <span style="color: rgb(0, 0, 0);">query</span>(<span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> b<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">int</span> <span style="color: rgb(0, 0, 0);">mid</span> <span style="color: rgb(0, 0, 0);">=</span> (<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span>) <span style="color: rgb(0, 0, 0);">&gt;&gt;</span> <span style="color: rgb(0, 0, 255);">1</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">==</span> <span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">&amp;&amp;</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span> <span style="color: rgb(0, 0, 0);">==</span> b<span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span> <span style="color: rgb(0, 0, 0);">+</span> (<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span> <span style="color: rgb(0, 0, 0);">-</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">+</span> <span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>;<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">else</span> <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span> <span style="color: rgb(0, 0, 0);">!=</span> <span style="color: rgb(0, 0, 255);">0</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">sum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">+=</span> (<span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">right</span> <span style="color: rgb(0, 0, 0);">-</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">left</span> <span style="color: rgb(0, 0, 0);">+</span> <span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>;<span style="color: rgb(0, 136, 0); font-style: italic;">//首先更新自己</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">+=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>;<span style="color: rgb(0, 136, 0); font-style: italic;">//然后传递给左右子树</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[(</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>&nbsp; <span style="color: rgb(0, 0, 0);">+=</span> <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">tree</span><span style="color: rgb(0, 0, 0);">[</span><span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">].</span><span style="color: rgb(0, 0, 0);">weight</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">=</span> <span style="color: rgb(0, 0, 255);">0</span>;<span style="color: rgb(0, 136, 0); font-style: italic;">//自身清零</span><br> <br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">if</span>(<span style="color: rgb(0, 0, 0);">a</span> <span style="color: rgb(0, 0, 0);">&lt;=</span> <span style="color: rgb(0, 0, 0);">mid</span> <span style="color: rgb(0, 0, 0);">&amp;&amp;</span> b <span style="color: rgb(0, 0, 0);">&gt;</span> <span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">){</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 0);">query</span>(<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">mid</span>) <span style="color: rgb(0, 0, 0);">+</span> <span style="color: rgb(0, 0, 0);">query</span>((<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>)<span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">,</span>b);<br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 0);">}</span><br> &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 128); font-weight: bold;">return</span> <span style="color: rgb(0, 0, 0);">query</span>((<span style="color: rgb(0, 0, 0);">i</span><span style="color: rgb(0, 0, 0);">&lt;&lt;</span><span style="color: rgb(0, 0, 255);">1</span>) <span style="color: rgb(0, 0, 0);">+</span> (b<span style="color: rgb(0, 0, 0);">&lt;=</span><span style="color: rgb(0, 0, 0);">mid</span><span style="color: rgb(0, 0, 0);">?</span><span style="color: rgb(0, 0, 255);">0</span><span style="color: rgb(0, 0, 0);">:</span><span style="color: rgb(0, 0, 255);">1</span><span style="color: rgb(0, 0, 0);">),</span><span style="color: rgb(0, 0, 0);">a</span><span style="color: rgb(0, 0, 0);">,</span>b);<br> <span style="color: rgb(0, 0, 0);">}</span><br></div><br><br>  <br><hr><br><p style="font-family: 微软雅黑;">题目链接: <a rel="nofollow" href="http://poj.grids.cn/practice/3439/">A Simple Problem with Integers</a>&nbsp;</p><p style="font-family: 微软雅黑;">一道很简单的线段树 YY了很长时间，开始add函数遍历到了叶子节点 超了，之后改成<strong>先记录下增加的值，当需要查询该区间时再更新该区间</strong>就可以了。<span style="line-height: 22px;">还有可以优化的地方，比如查询区间[2,5],可以用[1,5] - [1,1] ,这样对左右子树的查询可以缩减到对左子树的查询</span></p>

</div>

